<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'none'; style-src {{CSP_SOURCE}} 'unsafe-inline'; script-src 'nonce-{{NONCE}}';"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atlassian Login Hi</title>
    <style>
      body {
        font-family: var(--vscode-font-family);
        color: var(--vscode-foreground);
        background: var(--vscode-editor-background);
        margin: 0;
        padding: 24px;
      }

      h1 {
        font-size: 20px;
        margin: 0 0 16px 0;
      }

      .card {
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        background: var(--vscode-sideBar-background);
      }

      .row {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
      }

      label {
        font-size: 12px;
        color: var(--vscode-descriptionForeground);
      }

      input {
        padding: 8px 10px;
        border-radius: 4px;
        border: 1px solid var(--vscode-input-border);
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
      }

      .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      button {
        padding: 8px 14px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
      }

      button.secondary {
        background: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
      }

      .note {
        font-size: 12px;
        color: var(--vscode-descriptionForeground);
        margin-top: 8px;
      }

      .status {
        font-weight: 600;
      }

      .status-ok {
        color: #2ea043;
      }

      .status-missing {
        color: #d73a49;
      }
    </style>
  </head>

  <body>
    <h1>Connect to Atlassian IT DOESN'T YET</h1>

    <div class="card">
      <h2>API Token</h2>
      <p class="note">
        API settings: <span class="status {{API_STATUS_CLASS}}">{{API_STATUS}}</span>
      </p>
      <div class="row">
        <label for="baseUrl">Jira site URL</label>
        <input
          id="baseUrl"
          type="text"
          placeholder="https://your-domain.atlassian.net"
          value="{{BASE_URL}}"
        />
      </div>
      <div class="row">
        <label for="email">Atlassian account email</label>
        <input id="email" type="email" placeholder="you@company.com" value="{{EMAIL}}" />
      </div>
      <div class="row">
        <label for="apiToken">API token</label>
        <input id="apiToken" type="password" placeholder="Paste your API token" />
      </div>
      <div class="actions">
        <button id="saveToken">Save API Token</button>
      </div>
      <div class="note">Create an API token from your Atlassian account security settings.</div>
    </div>

    <div class="card">
      <h2>OAuth 2.0 (3LO)</h2>
      <p class="note">
        Requires an Atlassian OAuth app with a redirect URL. Configure client ID and secret in VS
        Code Settings.
      </p>
      <p class="note">
        OAuth settings: <span class="status {{OAUTH_STATUS_CLASS}}">{{OAUTH_STATUS}}</span>
      </p>
      <div class="actions">
        <button id="openSettings" class="secondary">Open Settings</button>
        <button id="startOAuth" {{OAUTH_DISABLED}}>Start OAuth Login</button>
      </div>
    </div>

    <script nonce="{{NONCE}}">
      const vscode = acquireVsCodeApi();

      document.getElementById("saveToken").addEventListener("click", () => {
        const baseUrl = document.getElementById("baseUrl").value.trim();
        const email = document.getElementById("email").value.trim();
        const apiToken = document.getElementById("apiToken").value.trim();

        if (!baseUrl || !email || !apiToken) {
          vscode.postMessage({ type: "error", message: "All fields are required." });
          return;
        }

        vscode.postMessage({ type: "saveApiToken", baseUrl, email, apiToken });
      });

      document.getElementById("startOAuth").addEventListener("click", () => {
        vscode.postMessage({ type: "startOAuth" });
      });

      document.getElementById("openSettings").addEventListener("click", () => {
        vscode.postMessage({ type: "openSettings" });
      });
    </script>
  </body>
</html>
