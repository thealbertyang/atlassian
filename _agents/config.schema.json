{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Atlassian Sprint View - Agent Configuration",
  "description": "Full app state configuration schema for _agents/config.local.json",
  "type": "object",
  "properties": {
    "app": {
      "type": "object",
      "description": "Application identity",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "version": { "type": "string" },
        "namespace": { "type": "string" },
        "extensionPath": { "type": "string" }
      },
      "required": ["id", "name", "namespace"]
    },
    "connection": {
      "type": "object",
      "description": "Jira connection state",
      "properties": {
        "baseUrl": { "type": "string", "format": "uri" },
        "email": { "type": "string", "format": "email" },
        "apiTokenConfigured": { "type": "boolean" },
        "configSource": {
          "type": "string",
          "enum": ["env.local", "env", "process.env", "settings", "mixed", "none"]
        },
        "authType": {
          "type": "string",
          "enum": ["apiToken", "none"]
        },
        "hasStoredToken": { "type": "boolean" }
      }
    },
    "settings": {
      "type": "object",
      "description": "VS Code extension settings (atlassian.*)",
      "properties": {
        "baseUrl": { "type": "string" },
        "jiraUrl": { "type": "string" },
        "email": { "type": "string" },
        "apiToken": { "type": "string", "description": "Always masked in output" },
        "jql": { "type": "string" },
        "maxResults": { "type": "number", "minimum": 1, "maximum": 500 },
        "docsPath": { "type": "string" },
        "webviewPath": { "type": "string" },
        "webviewServerUrl": { "type": "string" }
      }
    },
    "dev": {
      "type": "object",
      "description": "Development mode state",
      "properties": {
        "devMode": { "type": "boolean" },
        "extensionId": { "type": "string" },
        "uriScheme": { "type": "string" },
        "lastExtensionBuildAt": { "type": ["number", "null"] },
        "lastWebviewRenderAt": { "type": ["number", "null"] },
        "wsBridgePort": { "type": "number", "default": 5174 }
      }
    },
    "env": {
      "type": "object",
      "description": "Relevant environment variables (tokens masked)",
      "additionalProperties": { "type": "string" }
    },
    "agents": {
      "type": "object",
      "description": "Agent configuration directory state",
      "properties": {
        "configDir": { "type": "string", "default": "_agents" },
        "plansDir": { "type": "string", "default": "_agents/plans" },
        "plansCount": { "type": "number" },
        "hasLocalConfig": { "type": "boolean" }
      }
    },
    "ipc": {
      "type": "object",
      "description": "IPC protocol commands and events",
      "properties": {
        "commands": {
          "type": "array",
          "items": { "type": "string" }
        },
        "events": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
